<!DOCTYPE html>
<html>

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Past Workflows</title>
   <!--Links-->
   <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
   <h1>Redirecting...</h1>
   <script>
      // githubCode is read from the parameters of the url
      let githubCode = new URL(window.location.href).searchParams.get("code");
      console.log(githubCode);

      /* this function sends a POST request to our server containing githubCode. 
      It then waits for response to be fully loaded before saving github-token to session storeage and redirecting to localhost:3000 */
      async function postGithubTokenToServer(githubCode) {
         fetch("/githubToken", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
               gitCode: githubCode,
            })
         }).then(response => {
            response.json().then(responseData => {
               console.log(responseData.token);
               window.sessionStorage.setItem("github-token", responseData.token);
               window.location.replace("http://localhost:3000/");
            });
         });
      }
      postGithubTokenToServer(githubCode);
   </script>
</body>

</html>